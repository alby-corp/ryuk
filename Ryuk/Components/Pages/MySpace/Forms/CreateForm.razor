@using Atlassian.Jira
<MudPaper Class="pa-4">
    <MudForm Model="@_model" @ref="form" @bind-IsValid="@success" @bind-Errors="@errors">

        <MudSelect Label="Type" @bind-Value="_model.Type" Required RequiredError="You must select a Type">
            @foreach (var type in _types)
            {
                <MudSelectItem Value="@type">@type.Name</MudSelectItem>
            }
        </MudSelect>

        <MudTextField
            Label="Summary" For="@(() => _model.Summary)"
            @bind-Value="_model.Summary"
            Required RequiredError="You must select a Summary"
            Validation="@(new Func<string, int, IEnumerable<string>>(CreateModel.ValidateMinCharacters))"
            Clearable="true" />

        <MudTextField
            Label="Description" For="@(() => _model.Description)"
            @bind-Value="_model.Description"
            Lines="8"
            Clearable="true" />

        <MudTextField
            Label="Ticket Id" For="@(() => _model.Ticket)"
            @bind-Value="_model.Ticket"
            Validation="@(new Func<string, IEnumerable<string>>(CreateModel.ValidateTicketId))"
            Clearable="true" />

        <MudAutocomplete
            Label="Assignee"
            @bind-Value="_model.Assignee"
            T="JiraUser"
            ResetValueOnEmptyText="true"
            SearchFunc="GetAssignee"
            ShowProgressIndicator="true"
            AdornmentIcon="@Icons.Material.Filled.Search"
            AdornmentColor="Color.Dark" />

        <MudSelect Label="Priority" @bind-Value="_model.Priority" Required RequiredError="You must select a Priority">
            @foreach (var priority in _priorities)
            {
                <MudSelectItem Value="@priority">
                    <MudImage src="@priority.IconUrl" Height="12" Class="mr-1"/>@priority.Name
                </MudSelectItem>
            }
        </MudSelect>

        <MudSelect Label="Components" @bind-SelectedValues="_model.Components" MultiSelection="true" Required RequiredError="You must select a Components">
            @foreach (var component in _components)
            {
                <MudSelectItem Value="@component">@component.Name</MudSelectItem>
            }
        </MudSelect>

        <MudTextField Label="Labels" For="@(() => _model.Labels)"
                      @bind-Value="_model.Labels"
                      TextChanged="@SetValue"
                      Clearable="true" />

        <MudChipSet AllClosable="true" OnClose="@Closed">
            @foreach (var label in _labels)
            {
                <MudChip Text="@label"></MudChip>
            }
        </MudChipSet>

        <MudTextField
            Label="OriginalEstimate" For="@(() => _model.OriginalEstimate)"
            @bind-Value="_model.OriginalEstimate"/>

        <MudStack Row Justify="Justify.FlexEnd" AlignItems="AlignItems.End" Class="mt-2">
            <MudButton OnClick="@Close" Variant="Variant.Filled" Color="Color.Secondary" Class="ml-auto">Close</MudButton>
            <MudButton OnClick="@Validate" Variant="Variant.Filled" Color="Color.Primary">Create</MudButton>
        </MudStack>
    </MudForm>
</MudPaper>